MYSQLFLAGS = -u $(USER) -p$(PASS)
DATABASE = turnaround
MYSQL = mysql $(DATABASE) $(MYSQLFLAGS)

ROUTES = Q110 Q111 Q112 Q113 Q114 Q64 QM21 S40 S46 S48 S51 S52 S53 S76 X10 S42 S54 S66 \
	S81 S86 S90 S93 S96 S98 X1 X10B X11 X12 X14 X21 X7 S44 S56 S57 S62 S74 S78 X17 \
	S55 S84 X17A X17J X19 X2 X22 X22A X31 X4 X5 X8 S59 Q25 Q38 Q53 Q65 Q66 QM2 QM4 \
	B12 B14 B15 B17 B25 B42 B45 B65 B82 B83 B84 Q24 Q56 B8 B7 Q54 B2 B31 B41 B44 \
	B44+ B46 B49 B1 B47 B46+ B20 B26 B38 B52 B54 Q55 Q58 Q11 Q21 Q22 Q35 Q52 QM15 \
	QM5 QM6 BXM9 Q34 QM1 QM10 QM11 QM12 QM20 QM3 QM7 QM8 Q12 Q13 Q15 Q15A Q16 Q20A \
	Q28 Q31 Q32 Q44 Q48 Q76 Q20B Q26 Q17 Q27 Q88 Q44+ BX23 BXM10 BXM6 BXM7 BXM8 Q50 \
	QM16 QM17 QM18 B13 B24 B32 B39 B48 B57 B60 B62 Q59 BX12 BX12+ BX16 BX22 BX24 \
	Q85 Q42 B11 B16 B35 B37 B4 B43 B61 B63 B67 B68 B69 B70 B9 Q06 Q07 Q08 Q09 Q10 \
	BX26 BX28 BX29 BX30 BX34 BX38 BX39 BX4 BX40 BX42 BX4A BX5 Q3 Q30 Q4 Q5 Q77 Q84 \
	Q37 Q40 Q41 Q60 BX1 BX10 BX13 BX18 BX2 BX3 BX41 BX41+ BX7 BX9 M100 BX15 BX20 \
	Q100 Q101 Q102 Q103 Q104 Q18 Q19 Q23 Q29 Q33 Q39 Q47 Q49 Q67 Q69 Q70 Q72 QM24 \
	QM25 X15 X30 X42 M12 M14A M14D M20 M21 M22 M23 M31 M34+ M34A+ M42 M50 M57 M60+ \
	M101 M102 M103 M15 M86+ Q1 Q2 Q36 Q43 Q46 Q83 X63 X64 X68 B100 B103 BM1 BM2 BM3 \
	M66 M72 M79 M8 M9 M11 M116 M10 M104 M106 M2 M3 M4 M5 M96 M98 M1 M15+ M35 M7 \
	BM4 BM5 B3 B36 B6 B64 B74 X27 X28 X37 X38 BX11 BX17 BX19 BX21 BX27 BX31 BX32 \
	BX33 BX35 BX36 BX46 BX6 BX8 BXM1 BXM11 BXM2 BXM3 BXM4 BXM18 S61 S79+ S89 S91 \
	S92 S94 X3 X9

MONTH = 2015-10-01

evt/evt-$(MONTH).csv: $(foreach s,$(ROUTES),evt/$s.tsv)
	csvstack $^ > $@

evts: $(foreach s,$(ROUTES),evt/$s.tsv)

evt/%.tsv: sql/evt_route.sql | evt
	{ echo SET @the_month=\'$(MONTH)\', @the_route=\'$*\'\; ; cat $^ ; } | \
	$(MYSQL) > $@

evt:; mkdir -p $@
